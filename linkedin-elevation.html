<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîó LinkedIn Professional Elevation | SociallyFounded</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #003554 0%, #004a6b 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .back-link {
            position: fixed;
            top: 2rem;
            left: 2rem;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .elevation-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .demo-notice {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border: 1px solid rgba(251, 191, 36, 0.3);
            font-size: 0.9rem;
        }

        .status-indicator {
            display: none;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .already-connected {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .main-content {
            text-align: center;
        }

        .main-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #FFD700;
        }

        .progress-container {
            margin: 2rem 0;
            display: none;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            opacity: 1;
            transform: scale(1.1);
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .progress-step.active .step-circle {
            background: linear-gradient(135deg, #0077b5 0%, #005885 100%);
            border-color: #0077b5;
            animation: pulse 1.5s infinite;
        }

        .step-label {
            font-size: 0.8rem;
            text-align: center;
            max-width: 120px;
        }

        .benefits-section {
            margin: 2rem 0;
        }

        .benefits-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #FFD700;
        }

        .benefits-list {
            text-align: left;
            margin: 1rem 0;
        }

        .benefit-item {
            margin: 0.8rem 0;
            padding-left: 1.5rem;
            position: relative;
            line-height: 1.5;
        }

        .benefit-item::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #22c55e;
            font-weight: bold;
        }

        .privacy-notice {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1.5rem 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .action-button {
            background: linear-gradient(135deg, #0077b5 0%, #005885 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 1rem 0.5rem;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 119, 181, 0.3);
        }

        .secondary-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .secondary-button:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        .profile-preview {
            display: none;
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-preview h3 {
            color: #FFD700;
            margin-bottom: 1rem;
        }

        .profile-data {
            text-align: left;
            line-height: 1.6;
        }

        .profile-data div {
            margin: 0.5rem 0;
        }

        .skill-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .skill-tag {
            background: rgba(212, 175, 55, 0.2);
            color: #D4AF37;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .credibility-score {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(34, 197, 94, 0.2);
            margin-top: 1rem;
        }

        .score-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #22c55e;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.5s ease-out;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .elevation-card {
                padding: 2rem;
            }

            .progress-steps {
                flex-direction: column;
                gap: 1rem;
            }

            .benefits-list {
                margin-left: 1rem;
            }

            .back-link {
                position: relative;
                top: 0;
                left: 0;
                display: inline-block;
                margin-bottom: 1rem;
            }
        }

        .storage-debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 0.7rem;
            z-index: 1000;
            max-width: 200px;
        }
    </style>
</head>
<body>
    <div class="storage-debug" id="storageDebug">
        Storage: Checking...
    </div>

    <a href="core/profile.html" class="back-link" id="backLink">‚Üê Back to Profile</a>

    <div class="container">
        <div class="elevation-card">
            <div class="demo-notice">
                <strong>Demo Mode Active</strong><br>
                This demo simulates LinkedIn OAuth flow. In production, this would connect to real LinkedIn API with your actual credentials.
            </div>

            <div class="status-indicator success" id="successIndicator">
                <strong>LinkedIn Connected Successfully!</strong><br>
                Your professional profile has been verified and personas unlocked.
            </div>

            <div class="status-indicator error" id="errorIndicator">
                <strong>Connection Failed</strong><br>
                Please try again or contact support.
            </div>

            <div class="status-indicator already-connected" id="alreadyConnectedIndicator">
                <strong>Already Connected</strong><br>
                Your LinkedIn profile is already connected and verified.
            </div>

            <div class="main-content" id="mainContent">
                <h1 class="main-title">Connect Your LinkedIn Profile</h1>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-steps">
                        <div class="progress-step" id="step1">
                            <div class="step-circle">1</div>
                            <div class="step-label">Connecting to LinkedIn...</div>
                        </div>
                        <div class="progress-step" id="step2">
                            <div class="step-circle">2</div>
                            <div class="step-label">Retrieving profile data...</div>
                        </div>
                        <div class="progress-step" id="step3">
                            <div class="step-circle">3</div>
                            <div class="step-label">Analyzing professional background...</div>
                        </div>
                        <div class="progress-step" id="step4">
                            <div class="step-circle">4</div>
                            <div class="step-label">Structuring profile data...</div>
                        </div>
                        <div class="progress-step" id="step5">
                            <div class="step-circle">5</div>
                            <div class="step-label">Updating SociallyFounded profile...</div>
                        </div>
                    </div>
                </div>

                <div class="benefits-section">
                    <div class="benefits-title">What you'll unlock:</div>
                    <div class="benefits-list">
                        <div class="benefit-item"><strong>Founder Persona</strong> - AI-powered idea development with IP protection</div>
                        <div class="benefit-item"><strong>Mentor Persona</strong> - Guide entrepreneurs and publish research insights</div>
                        <div class="benefit-item"><strong>Professional Matching</strong> - Connect with verified industry experts</div>
                        <div class="benefit-item"><strong>AI-Structured Profile</strong> - Automatically organize your background</div>
                        <div class="benefit-item"><strong>Credibility Score</strong> - Boost your professional reputation</div>
                    </div>
                </div>

                <div class="privacy-notice">
                    üîí <strong>Privacy Protected:</strong> We only access your basic profile information (name, headline, experience) and email address. Your data is never shared without permission and stored securely.
                </div>

                <button class="action-button" id="connectButton" onclick="startLinkedInDemo()">
                    LinkedIn Profile Connected
                </button>

                <div class="profile-preview" id="profilePreview">
                    <h3>Your Professional Profile Preview</h3>
                    <div class="profile-data" id="profileData">
                        <!-- Profile data will be populated here -->
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button class="action-button" onclick="confirmElevation()">Confirm & Continue</button>
                        <button class="action-button secondary-button" onclick="resetDemo()">Start Over</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Same robust storage system as profile page
        class SFStorage {
            constructor() {
                this.method = this.detectBestStorage();
                this.updateDebug();
            }

            detectBestStorage() {
                try {
                    localStorage.setItem('sf_test', 'test');
                    localStorage.removeItem('sf_test');
                    return 'localStorage';
                } catch (e) {
                    console.log('localStorage blocked:', e.message);
                }

                try {
                    sessionStorage.setItem('sf_test', 'test');
                    sessionStorage.removeItem('sf_test');
                    return 'sessionStorage';
                } catch (e) {
                    console.log('sessionStorage blocked:', e.message);
                }

                try {
                    document.cookie = 'sf_test=test; path=/';
                    if (document.cookie.includes('sf_test=test')) {
                        document.cookie = 'sf_test=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/';
                        return 'cookie';
                    }
                } catch (e) {
                    console.log('Cookie storage blocked:', e.message);
                }

                return 'url';
            }

            setItem(key, value) {
                const serialized = JSON.stringify(value);
                
                try {
                    switch (this.method) {
                        case 'localStorage':
                            localStorage.setItem(key, serialized);
                            break;
                        case 'sessionStorage':
                            sessionStorage.setItem(key, serialized);
                            break;
                        case 'cookie':
                            document.cookie = `${key}=${encodeURIComponent(serialized)}; path=/; max-age=86400`;
                            break;
                        case 'url':
                            window[key] = value;
                            break;
                    }
                    this.updateDebug();
                    return true;
                } catch (e) {
                    console.error('Storage failed:', e);
                    this.updateDebug();
                    return false;
                }
            }

            getItem(key) {
                try {
                    let value = null;
                    
                    switch (this.method) {
                        case 'localStorage':
                            value = localStorage.getItem(key);
                            break;
                        case 'sessionStorage':
                            value = sessionStorage.getItem(key);
                            break;
                        case 'cookie':
                            const match = document.cookie.match(new RegExp('(^| )' + key + '=([^;]+)'));
                            value = match ? decodeURIComponent(match[2]) : null;
                            break;
                        case 'url':
                            value = window[key] ? JSON.stringify(window[key]) : null;
                            break;
                    }
                    
                    return value ? JSON.parse(value) : null;
                } catch (e) {
                    console.error('Storage retrieval failed:', e);
                    return null;
                }
            }

            updateDebug() {
                const debugEl = document.getElementById('storageDebug');
                if (debugEl) {
                    debugEl.textContent = `Storage: ${this.method}`;
                    debugEl.style.background = this.method === 'url' ? 'rgba(239, 68, 68, 0.8)' : 'rgba(34, 197, 94, 0.8)';
                }
            }
        }

        const sfStorage = new SFStorage();
        let currentLinkedInData = null;

        // Check if already connected
        function checkExistingConnection() {
            const userData = sfStorage.getItem('sf_user');
            if (userData?.verification?.linkedin?.verified) {
                showAlreadyConnected();
                return true;
            }
            return false;
        }

        function showAlreadyConnected() {
            document.getElementById('alreadyConnectedIndicator').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            
            setTimeout(() => {
                redirectToProfile();
            }, 2000);
        }

        function startLinkedInDemo() {
            if (checkExistingConnection()) return;
            
            // Hide main content and show progress
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'block';
            
            // Simulate the 5-step process
            simulateOAuthFlow();
        }

        function simulateOAuthFlow() {
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            let currentStep = 0;
            
            function activateNextStep() {
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    currentStep++;
                    
                    if (currentStep < steps.length) {
                        setTimeout(activateNextStep, 1500);
                    } else {
                        setTimeout(showProfilePreview, 1000);
                    }
                }
            }
            
            activateNextStep();
        }

        function showProfilePreview() {
            // Generate mock LinkedIn data
            const mockLinkedInData = generateMockLinkedInData();
            currentLinkedInData = mockLinkedInData;
            
            // Hide progress and show preview
            document.getElementById('progressContainer').style.display = 'none';
            
            // Populate profile preview
            populateProfilePreview(mockLinkedInData.professionalProfile);
            
            // Show preview
            document.getElementById('profilePreview').style.display = 'block';
            document.getElementById('profilePreview').classList.add('fade-in');
        }

        function generateMockLinkedInData() {
            const names = ['Alex Johnson', 'Sarah Chen', 'Michael Rodriguez', 'Emily Davis', 'David Kim'];
            const headlines = [
                'Senior Software Engineer | AI Enthusiast',
                'Product Manager | Digital Innovation Leader',
                'Data Scientist | Machine Learning Expert',
                'UX Designer | Human-Centered Design Advocate',
                'Marketing Director | Growth Strategy Specialist'
            ];
            const skillSets = [
                ['JavaScript', 'React', 'Node.js', 'AI/ML', 'Product Strategy'],
                ['Product Management', 'Data Analysis', 'UX Research', 'Agile', 'Strategy'],
                ['Python', 'Machine Learning', 'Data Science', 'Statistics', 'TensorFlow'],
                ['UI/UX Design', 'Figma', 'User Research', 'Prototyping', 'Design Systems'],
                ['Digital Marketing', 'Growth Hacking', 'Analytics', 'Content Strategy', 'SEO']
            ];
            const positions = [
                [
                    { title: 'Senior Software Engineer', companyName: 'TechCorp Inc.' },
                    { title: 'Software Engineer', companyName: 'StartupXYZ' }
                ],
                [
                    { title: 'Product Manager', companyName: 'InnovateLabs' },
                    { title: 'Associate Product Manager', companyName: 'GrowthCo' }
                ],
                [
                    { title: 'Data Scientist', companyName: 'DataDriven LLC' },
                    { title: 'Junior Data Analyst', companyName: 'Analytics Pro' }
                ],
                [
                    { title: 'Senior UX Designer', companyName: 'DesignStudio' },
                    { title: 'UI Designer', companyName: 'Creative Agency' }
                ],
                [
                    { title: 'Marketing Director', companyName: 'GrowthMarketing' },
                    { title: 'Marketing Manager', companyName: 'BrandBuilders' }
                ]
            ];
            
            const randomIndex = Math.floor(Math.random() * names.length);
            
            return {
                id: `demo_linkedin_${Date.now()}`,
                professionalProfile: {
                    fullName: names[randomIndex],
                    headline: headlines[randomIndex],
                    skills: skillSets[randomIndex],
                    positions: positions[randomIndex],
                    credibilityScore: Math.floor(Math.random() * 20) + 80 // 80-99
                }
            };
        }

        function populateProfilePreview(profile) {
            const profileData = document.getElementById('profileData');
            
            profileData.innerHTML = `
                <div><strong>Name:</strong> ${profile.fullName}</div>
                <div><strong>Headline:</strong> ${profile.headline}</div>
                <div><strong>Experience:</strong></div>
                ${profile.positions.map(pos => 
                    `<div style="margin-left: 1rem;">‚Ä¢ ${pos.title} at ${pos.companyName}</div>`
                ).join('')}
                <div><strong>Skills:</strong></div>
                <div class="skill-tags">
                    ${profile.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                </div>
                <div class="credibility-score">
                    <div class="score-number">${profile.credibilityScore}</div>
                    <div>
                        <div>Credibility Score</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;">Based on LinkedIn verification</div>
                    </div>
                </div>
            `;
        }

        function confirmElevation() {
            if (!currentLinkedInData) {
                showError();
                return;
            }
            
            // Generate complete user data
            const userData = {
                passportId: 'SF-DEMO01',
                passport: {
                    level: 2,
                    experience: 500,
                    tier: 'Silver'
                },
                verification: {
                    linkedin: {
                        verified: true,
                        connectedAt: new Date().toISOString(),
                        id: currentLinkedInData.id
                    }
                },
                professionalProfile: currentLinkedInData.professionalProfile,
                personas: {
                    founder: { active: true, linkedinVerified: true },
                    mentor: { active: true, linkedinVerified: true }
                }
            };
            
            // Try to save to storage
            const saved = sfStorage.setItem('sf_user', userData);
            
            if (saved && sfStorage.method !== 'url') {
                // Storage worked, show success and redirect
                showSuccess();
                setTimeout(redirectToProfile, 2000);
            } else {
                // Storage failed or using URL fallback, pass data via URL
                redirectWithData(currentLinkedInData);
            }
        }

        function redirectWithData(linkedinData) {
            const profileUrl = new URL('core/profile.html', window.location.origin);
            profileUrl.searchParams.set('elevated', 'true');
            profileUrl.searchParams.set('linkedin', encodeURIComponent(JSON.stringify(linkedinData)));
            
            window.location.href = profileUrl.toString();
        }

        function redirectToProfile() {
            window.location.href = 'core/profile.html';
        }

        function showSuccess() {
            document.getElementById('profilePreview').style.display = 'none';
            document.getElementById('successIndicator').style.display = 'block';
        }

        function showError() {
            document.getElementById('profilePreview').style.display = 'none';
            document.getElementById('errorIndicator').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('errorIndicator').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            }, 3000);
        }

        function resetDemo() {
            // Clear any stored data
            sfStorage.removeItem('sf_user');
            
            // Reset UI
            document.getElementById('profilePreview').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            // Reset progress steps
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach(step => step.classList.remove('active'));
            
            currentLinkedInData = null;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if already connected
            checkExistingConnection();
            
            // Update back link if needed
            const backLink = document.getElementById('backLink');
            if (sfStorage.method === 'url') {
                backLink.href = 'core/profile.html';
            }
        });

        // Debug functions
        window.linkedinDebug = {
            storage: sfStorage,
            reset: resetDemo,
            skip: () => {
                const mockData = generateMockLinkedInData();
                currentLinkedInData = mockData;
                confirmElevation();
            }
        };
    </script>
</body>
</html>

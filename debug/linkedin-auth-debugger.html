<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Auth Failure Debugger - SociallyFounded</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #FFFFFF;
            color: #003554;
            min-height: 100vh;
            padding: 20px;
        }
        
        .debugger-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #FFFFFF;
            border: 2px solid #003554;
            border-radius: 12px;
            padding: 30px;
        }
        
        .sf-logo {
            height: 40px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #003554;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        h2 {
            color: #003554;
            font-weight: 500;
            margin: 30px 0 15px 0;
        }
        
        .error-box {
            background: #ffebee;
            border: 1px solid #f44336;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            color: #d32f2f;
        }
        
        .warning-box {
            background: #fff3e0;
            border: 1px solid #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: #f57c00;
        }
        
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: #1976d2;
        }
        
        .success-box {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: #2e7d32;
        }
        
        .test-btn {
            background: #0077B5;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            background: #005885;
        }
        
        .test-btn.danger {
            background: #f44336;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .checklist li:before {
            content: "‚òê ";
            color: #ff9800;
            font-weight: bold;
            margin-right: 5px;
        }
        
        .checklist li.checked:before {
            content: "‚úÖ ";
        }
        
        .step-number {
            background: #003554;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .auth-url-builder {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .url-display {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="debugger-container">
        <img src="https://sociallyfounded.com/assets/sf-logo.png" alt="SociallyFounded" class="sf-logo">
        
        <h1>üîç LinkedIn Authorization Failure Debugger</h1>
        
        <div class="error-box">
            <h3>üö® Current Issue: Authorization Fails at LinkedIn</h3>
            <p>The OAuth flow fails when LinkedIn tries to authorize your application. Let's identify the exact cause.</p>
        </div>

        <h2><span class="step-number">1</span>Check Current OAuth URL</h2>
        <div class="auth-url-builder">
            <h4>üîó Your Current OAuth Configuration:</h4>
            <p><strong>Client ID:</strong> <span id="clientId">77tpngrlwmwnz7</span></p>
            <p><strong>Redirect URI:</strong> <span id="redirectUri"></span></p>
            <p><strong>Current Domain:</strong> <span id="currentDomain"></span></p>
            
            <button class="test-btn" onclick="buildOAuthURL()">üèóÔ∏è Build OAuth URL</button>
            <button class="test-btn" onclick="testManualAuth()">üß™ Test Manual Auth</button>
            
            <div id="oauthUrlDisplay" class="url-display" style="display: none;"></div>
        </div>

        <h2><span class="step-number">2</span>LinkedIn App Configuration Checklist</h2>
        <div class="warning-box">
            <h4>‚ö†Ô∏è Critical: Every detail must match exactly</h4>
            <p>LinkedIn OAuth is extremely strict about configuration. One character difference will cause failure.</p>
        </div>
        
        <div class="info-box">
            <h4>üìã Required LinkedIn App Settings</h4>
            <p><strong>Go to:</strong> <a href="https://developer.linkedin.com/apps/3471394/auth" target="_blank">LinkedIn Developer Portal ‚Üí Auth Tab</a></p>
            
            <ul class="checklist">
                <li class="checked">Client ID: 77tpngrlwmwnz7</li>
                <li class="checked">Client Secret: WPL_AP1.vV3sYWZIFx13yovS.Y/eb9w==</li>
                <li id="redirectCheck1">Redirect URI: https://sociallyfounded.com/linkedin-callback.html</li>
                <li id="redirectCheck2">Redirect URI: https://www.sociallyfounded.com/linkedin-callback.html</li>
                <li id="redirectCheck3">Redirect URI: https://socially-founded.vercel.app/linkedin-callback.html</li>
                <li id="productCheck">Product: "Sign In with LinkedIn using OpenID Connect" - LIVE status</li>
                <li id="scopeCheck1">Scope: openid ‚úì</li>
                <li id="scopeCheck2">Scope: profile ‚úì</li>
                <li id="scopeCheck3">Scope: email ‚úì</li>
            </ul>
            
            <button class="test-btn" onclick="verifyLinkedInConfig()">‚úÖ Mark as Verified</button>
        </div>

        <h2><span class="step-number">3</span>Test Different Redirect URIs</h2>
        <div class="warning-box">
            <h4>üéØ The redirect URI must match EXACTLY</h4>
            <p>Test each redirect URI separately to find which one works.</p>
        </div>
        
        <div id="redirectTests">
            <button class="test-btn" onclick="testRedirectURI('https://sociallyfounded.com/linkedin-callback.html')">
                Test: sociallyfounded.com
            </button>
            <button class="test-btn" onclick="testRedirectURI('https://www.sociallyfounded.com/linkedin-callback.html')">
                Test: www.sociallyfounded.com
            </button>
            <button class="test-btn" onclick="testRedirectURI('https://socially-founded.vercel.app/linkedin-callback.html')">
                Test: socially-founded.vercel.app
            </button>
        </div>
        
        <div id="redirectTestResults" style="margin-top: 20px;"></div>

        <h2><span class="step-number">4</span>Check LinkedIn Error Details</h2>
        <div class="info-box">
            <h4>üîç When LinkedIn authorization fails, check for:</h4>
            <ul style="margin: 10px 0 0 20px;">
                <li><strong>URL Parameters:</strong> Look for ?error=... in the callback URL</li>
                <li><strong>Error Messages:</strong> LinkedIn shows specific error reasons</li>
                <li><strong>Browser Console:</strong> Check for JavaScript errors</li>
                <li><strong>Network Tab:</strong> Look for failed requests</li>
            </ul>
        </div>
        
        <button class="test-btn" onclick="enableDebugMode()">üêõ Enable Debug Mode</button>
        <div id="debugOutput" style="display: none; margin-top: 15px;"></div>

        <h2><span class="step-number">5</span>Common LinkedIn OAuth Failures</h2>
        <div class="error-box">
            <h4>‚ùå Most Common Issues:</h4>
            <ol style="margin: 10px 0 0 20px;">
                <li><strong>redirect_uri_mismatch:</strong> Your callback URL doesn't exactly match what's in LinkedIn app</li>
                <li><strong>invalid_client_id:</strong> Client ID is wrong or app is not approved</li>
                <li><strong>access_denied:</strong> User denied permission (or app not approved)</li>
                <li><strong>invalid_scope:</strong> Requesting scopes that aren't approved</li>
                <li><strong>unauthorized_client:</strong> App doesn't have required products/permissions</li>
            </ol>
        </div>

        <h2><span class="step-number">6</span>Alternative Debugging</h2>
        <div class="success-box">
            <h4>üõ†Ô∏è Try These Debug Methods:</h4>
            <ol style="margin: 10px 0 0 20px;">
                <li><strong>LinkedIn Postman:</strong> Test OAuth manually with Postman</li>
                <li><strong>Minimal Test:</strong> Create simple HTML page with just OAuth link</li>
                <li><strong>Browser Private Mode:</strong> Test in incognito to avoid cache issues</li>
                <li><strong>Different LinkedIn Account:</strong> Try with another LinkedIn account</li>
            </ol>
            
            <button class="test-btn" onclick="generateMinimalTest()">üìÑ Generate Minimal Test Page</button>
        </div>

        <div id="minimalTestCode" style="display: none; margin-top: 20px;">
            <h4>Minimal Test HTML:</h4>
            <div class="code-block" id="minimalTestContent"></div>
        </div>
    </div>

    <script>
        const LINKEDIN_CLIENT_ID = '77tpngrlwmwnz7';
        let currentRedirectURI = '';
        
        // Set current domain info
        document.addEventListener('DOMContentLoaded', function() {
            const currentDomain = window.location.origin;
            const redirectUri = currentDomain + '/linkedin-callback.html';
            
            document.getElementById('currentDomain').textContent = currentDomain;
            document.getElementById('redirectUri').textContent = redirectUri;
            currentRedirectURI = redirectUri;
        });

        function buildOAuthURL() {
            const state = generateRandomString(16);
            const scope = 'openid profile email';
            
            const authUrl = 'https://www.linkedin.com/oauth/v2/authorization?' +
                `response_type=code&` +
                `client_id=${LINKEDIN_CLIENT_ID}&` +
                `redirect_uri=${encodeURIComponent(currentRedirectURI)}&` +
                `state=${state}&` +
                `scope=${encodeURIComponent(scope)}`;
            
            const display = document.getElementById('oauthUrlDisplay');
            display.innerHTML = `
üîó OAuth URL:
${authUrl}

üìã Breakdown:
- Base URL: https://www.linkedin.com/oauth/v2/authorization
- response_type: code
- client_id: ${LINKEDIN_CLIENT_ID}
- redirect_uri: ${currentRedirectURI}
- state: ${state}
- scope: ${scope}

‚ö†Ô∏è Copy this URL and test in a new browser tab to see the exact LinkedIn error.
            `;
            display.style.display = 'block';
            
            console.log('OAuth URL built:', authUrl);
        }

        function testManualAuth() {
            const state = generateRandomString(16);
            sessionStorage.setItem('linkedin_oauth_state', state);
            sessionStorage.setItem('linkedin_debug_test', 'manual');
            
            const authUrl = 'https://www.linkedin.com/oauth/v2/authorization?' +
                `response_type=code&` +
                `client_id=${LINKEDIN_CLIENT_ID}&` +
                `redirect_uri=${encodeURIComponent(currentRedirectURI)}&` +
                `state=${state}&` +
                `scope=openid%20profile%20email`;
            
            console.log('Manual test starting:', {
                redirectUri: currentRedirectURI,
                state: state,
                url: authUrl
            });
            
            window.open(authUrl, '_blank');
        }

        function testRedirectURI(uri) {
            const state = generateRandomString(16);
            sessionStorage.setItem('linkedin_oauth_state', state);
            sessionStorage.setItem('linkedin_debug_redirect', uri);
            
            const authUrl = 'https://www.linkedin.com/oauth/v2/authorization?' +
                `response_type=code&` +
                `client_id=${LINKEDIN_CLIENT_ID}&` +
                `redirect_uri=${encodeURIComponent(uri)}&` +
                `state=${state}&` +
                `scope=openid%20profile%20email`;
            
            const results = document.getElementById('redirectTestResults');
            results.innerHTML += `
                <div class="info-box">
                    <h4>üß™ Testing Redirect URI: ${uri}</h4>
                    <p><strong>State:</strong> ${state}</p>
                    <p><strong>Test URL:</strong> <a href="${authUrl}" target="_blank">Click to test</a></p>
                    <p><em>Opens in new tab. Check for errors or success.</em></p>
                </div>
            `;
            
            console.log('Testing redirect URI:', uri, 'with state:', state);
        }

        function verifyLinkedInConfig() {
            // Mark all checklist items as verified
            const checkItems = [
                'redirectCheck1', 'redirectCheck2', 'redirectCheck3',
                'productCheck', 'scopeCheck1', 'scopeCheck2', 'scopeCheck3'
            ];
            
            checkItems.forEach(id => {
                const item = document.getElementById(id);
                if (item) {
                    item.className = 'checked';
                }
            });
            
            alert('‚úÖ LinkedIn configuration marked as verified!\n\nIf authorization still fails, the issue is likely:\n1. Redirect URI exact match problem\n2. LinkedIn product approval pending\n3. Account-specific restrictions');
        }

        function enableDebugMode() {
            const debugOutput = document.getElementById('debugOutput');
            debugOutput.style.display = 'block';
            
            debugOutput.innerHTML = `
                <div class="warning-box">
                    <h4>üêõ Debug Mode Enabled</h4>
                    <p>Open browser Developer Tools (F12) and watch:</p>
                    <ul style="margin: 10px 0 0 20px;">
                        <li><strong>Console:</strong> JavaScript errors and logs</li>
                        <li><strong>Network:</strong> Failed requests to LinkedIn</li>
                        <li><strong>Application:</strong> localStorage/sessionStorage values</li>
                    </ul>
                    <p><strong>Next:</strong> Try the OAuth flow and check for errors in these tabs.</p>
                </div>
            `;
            
            // Enable console debugging
            window.addEventListener('error', function(e) {
                console.error('üêõ Debug Error:', e.error);
                debugOutput.innerHTML += `<div class="error-box">JavaScript Error: ${e.message}</div>`;
            });
            
            console.log('üêõ Debug mode enabled. OAuth events will be logged.');
        }

        function generateMinimalTest() {
            const minimalHTML = `<!DOCTYPE html>
<html>
<head>
    <title>LinkedIn OAuth Minimal Test</title>
</head>
<body>
    <h1>LinkedIn OAuth Minimal Test</h1>
    <p>Client ID: ${LINKEDIN_CLIENT_ID}</p>
    <p>Redirect URI: ${currentRedirectURI}</p>
    
    <a href="https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${LINKEDIN_CLIENT_ID}&redirect_uri=${encodeURIComponent(currentRedirectURI)}&state=test123&scope=openid%20profile%20email" 
       target="_blank">
        üîó Test LinkedIn OAuth (Minimal)
    </a>
    
    <script>
        console.log('Minimal test page loaded');
        console.log('Client ID: ${LINKEDIN_CLIENT_ID}');
        console.log('Redirect URI: ${currentRedirectURI}');
    </script>
</body>
</html>`;

            const codeDiv = document.getElementById('minimalTestContent');
            codeDiv.textContent = minimalHTML;
            
            const container = document.getElementById('minimalTestCode');
            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
            
            console.log('Minimal test HTML generated');
        }

        function generateRandomString(length) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Check if we're coming back from a LinkedIn test
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('error')) {
            const errorBox = document.createElement('div');
            errorBox.className = 'error-box';
            errorBox.innerHTML = `
                <h4>‚ùå LinkedIn Error Detected:</h4>
                <p><strong>Error:</strong> ${urlParams.get('error')}</p>
                <p><strong>Description:</strong> ${urlParams.get('error_description') || 'Not provided'}</p>
            `;
            document.querySelector('.debugger-container').insertBefore(errorBox, document.querySelector('h2'));
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SF localStorage Inspector</title>
    <style>
        body { 
            font-family: 'Monaco', 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #fff;
            line-height: 1.6;
        }
        .panel { 
            background: #2d2d2d; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            border-left: 4px solid #d4af37;
        }
        .title { 
            color: #d4af37; 
            font-weight: bold; 
            margin-bottom: 15px; 
            font-size: 18px;
        }
        pre { 
            background: #1e1e1e; 
            padding: 15px; 
            border-radius: 4px; 
            overflow-x: auto; 
            border: 1px solid #444;
            white-space: pre-wrap;
        }
        .btn { 
            background: #003554; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
            font-family: inherit;
        }
        .btn:hover { background: #004a6b; }
        .btn.danger { background: #c62828; }
        .btn.success { background: #2d7d32; }
        .status { 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0; 
            font-weight: bold;
        }
        .status.success { background: #1b5e20; color: #4caf50; }
        .status.error { background: #b71c1c; color: #f44336; }
        .status.warning { background: #e65100; color: #ff9800; }
        .json-key { color: #9cdcfe; }
        .json-string { color: #ce9178; }
        .json-number { color: #b5cea8; }
        .json-boolean { color: #569cd6; }
    </style>
</head>
<body>
    <h1>üîß SF localStorage Inspector & Fixer</h1>
    
    <div class="panel">
        <div class="title">üìä Current User Data</div>
        <pre id="userDataDisplay">Loading...</pre>
        <button class="btn" onclick="refreshData()">üîÑ Refresh</button>
        <button class="btn success" onclick="fixMentorAccess()">üéì Fix Mentor Access</button>
        <button class="btn danger" onclick="clearAndRestart()">üóëÔ∏è Clear All & Restart</button>
    </div>

    <div class="panel">
        <div class="title">üîç Access Status Check</div>
        <div id="accessStatus">Checking...</div>
    </div>

    <div class="panel">
        <div class="title">üõ†Ô∏è Quick Fixes</div>
        <button class="btn" onclick="unlockAllPersonas()">üîì Unlock All Personas</button>
        <button class="btn" onclick="addLinkedInVerification()">‚úÖ Add LinkedIn Verification</button>
        <button class="btn" onclick="resetToWorkingState()">üöÄ Reset to Working State</button>
    </div>

    <div class="panel">
        <div class="title">üéØ Navigation Test</div>
        <a href="../mentor/dashboard.html" class="btn">Test Mentor Dashboard</a>
        <a href="../founder/ideas.html" class="btn">Test Founder Ideas</a>
        <a href="../core/profile.html" class="btn">Back to Profile</a>
    </div>

    <script>
        function refreshData() {
            console.log('üîÑ Refreshing localStorage data...');
            
            const userData = localStorage.getItem('sf_current_user');
            const userDataDisplay = document.getElementById('userDataDisplay');
            
            if (userData) {
                try {
                    const parsed = JSON.parse(userData);
                    userDataDisplay.textContent = JSON.stringify(parsed, null, 2);
                    console.log('‚úÖ User data loaded:', parsed);
                } catch (e) {
                    userDataDisplay.textContent = 'ERROR: Invalid JSON in localStorage\n\n' + userData;
                    console.error('‚ùå JSON parse error:', e);
                }
            } else {
                userDataDisplay.textContent = 'No sf_current_user found in localStorage';
                console.log('‚ö†Ô∏è No user data found');
            }
            
            checkAccessStatus();
        }

        function checkAccessStatus() {
            const currentUser = JSON.parse(localStorage.getItem('sf_current_user') || '{}');
            const statusDiv = document.getElementById('accessStatus');
            
            let status = '<div class="status">';
            
            // Check passport
            if (currentUser.passportId) {
                status += '<div class="status success">‚úÖ SF Passport: ' + currentUser.passportId + '</div>';
            } else {
                status += '<div class="status error">‚ùå No SF Passport found</div>';
            }
            
            // Check verification
            if (currentUser.verification && currentUser.verification.linkedin) {
                status += '<div class="status success">‚úÖ LinkedIn Verified</div>';
            } else {
                status += '<div class="status error">‚ùå No LinkedIn verification</div>';
            }
            
            // Check personas
            if (currentUser.personas) {
                if (currentUser.personas.founder) {
                    status += '<div class="status success">‚úÖ Founder Persona Unlocked</div>';
                } else {
                    status += '<div class="status warning">‚ö†Ô∏è Founder Persona Locked</div>';
                }
                
                if (currentUser.personas.mentor) {
                    status += '<div class="status success">‚úÖ Mentor Persona Unlocked</div>';
                } else {
                    status += '<div class="status warning">‚ö†Ô∏è Mentor Persona Locked</div>';
                }
            } else {
                status += '<div class="status error">‚ùå No personas data found</div>';
            }
            
            status += '</div>';
            statusDiv.innerHTML = status;
        }

        function fixMentorAccess() {
            console.log('üîß Fixing mentor access...');
            
            const currentUser = JSON.parse(localStorage.getItem('sf_current_user') || '{}');
            
            // Auto-generate passportId if missing
            if (!currentUser.passportId) {
                currentUser.passportId = 'SF-' + Math.floor(Math.random() * 900000 + 100000);
                console.log('üÜî Generated missing passportId:', currentUser.passportId);
            }
            
            // Ensure verification exists
            if (!currentUser.verification) {
                currentUser.verification = {};
            }
            
            // Add LinkedIn verification if missing
            if (!currentUser.verification.linkedin) {
                currentUser.verification.linkedin = {
                    verified: true,
                    email: currentUser.email || 'user@sociallyfounded.com',
                    timestamp: new Date().toISOString()
                };
                console.log('‚úÖ Added LinkedIn verification');
            }
            
            // Ensure personas exists
            if (!currentUser.personas) {
                currentUser.personas = {};
            }
            
            // Unlock mentor persona
            currentUser.personas.mentor = true;
            currentUser.personas.founder = true; // Also unlock founder for good measure
            
            // Ensure passport data exists
            if (!currentUser.passport) {
                currentUser.passport = {
                    level: 2,
                    experience: 1250,
                    tier: 'Navy'
                };
            }
            
            // Save back to localStorage
            localStorage.setItem('sf_current_user', JSON.stringify(currentUser));
            
            console.log('‚úÖ Mentor access fixed!');
            console.log('üìä Complete user data:', currentUser);
            refreshData();
            
            alert('‚úÖ All access issues fixed! You should now be able to access all personas.');
        }

        function addLinkedInVerification() {
            const currentUser = JSON.parse(localStorage.getItem('sf_current_user') || '{}');
            
            if (!currentUser.verification) {
                currentUser.verification = {};
            }
            
            currentUser.verification.linkedin = {
                verified: true,
                email: currentUser.email || 'user@example.com',
                name: currentUser.profile?.name || 'SF User',
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('sf_current_user', JSON.stringify(currentUser));
            refreshData();
            alert('‚úÖ LinkedIn verification added!');
        }

        function unlockAllPersonas() {
            const currentUser = JSON.parse(localStorage.getItem('sf_current_user') || '{}');
            
            currentUser.personas = {
                founder: true,
                mentor: true,
                host: true,
                investor: true
            };
            
            localStorage.setItem('sf_current_user', JSON.stringify(currentUser));
            refreshData();
            alert('üîì All personas unlocked!');
        }

        function resetToWorkingState() {
            const workingUser = {
                passportId: 'SF-' + Math.floor(Math.random() * 900000 + 100000),
                email: 'test@sociallyfounded.com',
                profile: {
                    name: 'SF Test User',
                    memberSince: new Date().toISOString()
                },
                verification: {
                    linkedin: {
                        verified: true,
                        email: 'test@sociallyfounded.com',
                        name: 'SF Test User',
                        timestamp: new Date().toISOString()
                    }
                },
                personas: {
                    founder: true,
                    mentor: true,
                    host: false,
                    investor: false
                },
                passport: {
                    level: 2,
                    experience: 1250,
                    tier: 'Navy'
                }
            };
            
            localStorage.setItem('sf_current_user', JSON.stringify(workingUser));
            refreshData();
            alert('üöÄ Reset to working state! You should now have full access.');
        }

        function clearAndRestart() {
            if (confirm('‚ö†Ô∏è This will clear ALL SF data and require you to sign up again. Continue?')) {
                localStorage.removeItem('sf_current_user');
                localStorage.removeItem('sf_mentor_data');
                localStorage.removeItem('sf_founder_ideas');
                refreshData();
                alert('üóëÔ∏è All data cleared! Go back to homepage to sign up again.');
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', refreshData);
    </script>
</body>
</html>

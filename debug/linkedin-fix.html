<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Integration Fix - SociallyFounded</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #FFFFFF;
            color: #003554;
            min-height: 100vh;
            padding: 20px;
        }
        
        .fix-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #FFFFFF;
            border: 2px solid #003554;
            border-radius: 12px;
            padding: 30px;
        }
        
        .sf-logo {
            height: 40px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #003554;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        h2 {
            color: #003554;
            font-weight: 500;
            margin: 30px 0 15px 0;
        }
        
        .current-config {
            background: #F5F5F5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .fix-box {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .linkedin-test-btn {
            background: #0077B5;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .linkedin-test-btn:hover {
            background: #005885;
        }
        
        .warning-box {
            background: #fff3e0;
            border: 1px solid #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: #f57c00;
        }
        
        .step-number {
            background: #003554;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="fix-container">
        <img src="https://sociallyfounded.com/assets/sf-logo.png" alt="SociallyFounded" class="sf-logo">
        
        <h1>üîó LinkedIn Integration Fix</h1>
        
        <div class="current-config">
            <h3>Current LinkedIn App Configuration:</h3>
            <div class="code-block">Client ID: 77tpngrlwmwnz7
Status: ‚úÖ Configured in LinkedIn Developer Portal
Redirect URIs: Need to be verified</div>
        </div>

        <h2><span class="step-number">1</span>Update index.html LinkedIn Configuration</h2>
        <div class="fix-box">
            <p><strong>Fix:</strong> Update the LinkedIn configuration in your index.html file.</p>
            <p>Find this section around line 1200 in index.html:</p>
            <div class="code-block">// LinkedIn Configuration
const LINKEDIN_CLIENT_ID = '77tpngrlwmwnz7';
const LINKEDIN_REDIRECT_URI = window.location.origin + '/linkedin-callback.html';
const LINKEDIN_SCOPE = 'openid profile email';</div>
            <p><strong>‚úÖ This is already correct!</strong> Your Client ID is properly set.</p>
        </div>

        <h2><span class="step-number">2</span>LinkedIn Developer Portal Settings</h2>
        <div class="warning-box">
            <strong>‚ö†Ô∏è Critical:</strong> You need to add these redirect URIs in your LinkedIn app settings:
        </div>
        <div class="code-block">Authorized redirect URLs for your app:
https://sociallyfounded.com/linkedin-callback.html
https://www.sociallyfounded.com/linkedin-callback.html
https://socially-founded.vercel.app/linkedin-callback.html

For development testing:
http://localhost:3000/linkedin-callback.html
http://127.0.0.1:3000/linkedin-callback.html</div>

        <h2><span class="step-number">3</span>Test LinkedIn Authentication</h2>
        <div class="fix-box">
            <p>Test the LinkedIn OAuth flow with the correct Client ID:</p>
            <button class="linkedin-test-btn" onclick="testLinkedInReal()">
                üîó Test Real LinkedIn OAuth
            </button>
            <button class="linkedin-test-btn" onclick="testLinkedInSimulated()" style="background: #666;">
                üß™ Test Simulated Flow (Development)
            </button>
        </div>

        <h2><span class="step-number">4</span>Backend API Endpoint (Optional)</h2>
        <div class="warning-box">
            <strong>Note:</strong> For production, you should create a backend endpoint to securely exchange the authorization code for an access token.
        </div>
        <div class="code-block">// Backend endpoint needed: /api/linkedin/exchange-token
// This keeps your LinkedIn client secret secure
// For now, we'll use client-side flow with limited scopes</div>

        <h2><span class="step-number">5</span>Debug Information</h2>
        <div class="current-config">
            <h3>Current Environment:</h3>
            <div id="debugInfo" class="code-block">Loading environment info...</div>
        </div>

        <h2><span class="step-number">6</span>LinkedIn Scope Permissions</h2>
        <div class="fix-box">
            <p>Your app requests these LinkedIn permissions:</p>
            <div class="code-block">openid - Basic identity verification
profile - Access to profile information  
email - Email address access

Additional scopes you might want to request:
w_member_social - Share content capability
r_liteprofile - Basic profile info (legacy)
r_emailaddress - Email access (legacy)</div>
        </div>

        <div id="testResults" style="margin-top: 30px; display: none;">
            <h2>üß™ Test Results</h2>
            <div id="resultsContent" class="current-config"></div>
        </div>
    </div>

    <script>
        // Your existing LinkedIn configuration (this is correct!)
        const LINKEDIN_CLIENT_ID = '77tpngrlwmwnz7';
        const LINKEDIN_REDIRECT_URI = window.location.origin + '/linkedin-callback.html';
        const LINKEDIN_SCOPE = 'openid profile email';

        function generateRandomString(length) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function testLinkedInReal() {
            // Test the real LinkedIn OAuth flow
            const state = generateRandomString(16);
            sessionStorage.setItem('linkedin_oauth_state', state);
            sessionStorage.setItem('linkedin_auth_intent', 'test');
            
            const authUrl = 'https://www.linkedin.com/oauth/v2/authorization?' +
                `response_type=code&` +
                `client_id=${LINKEDIN_CLIENT_ID}&` +
                `redirect_uri=${encodeURIComponent(LINKEDIN_REDIRECT_URI)}&` +
                `state=${state}&` +
                `scope=${encodeURIComponent(LINKEDIN_SCOPE)}`;
            
            console.log('LinkedIn OAuth URL:', authUrl);
            
            // Show test results
            showTestResults('Real LinkedIn OAuth', `
                <strong>‚úÖ OAuth URL Generated:</strong><br>
                <div style="word-break: break-all; font-size: 12px; background: #f0f0f0; padding: 10px; border-radius: 4px; margin: 10px 0;">
                    ${authUrl}
                </div>
                <p><strong>State:</strong> ${state}</p>
                <p><strong>Client ID:</strong> ${LINKEDIN_CLIENT_ID}</p>
                <p><strong>Redirect URI:</strong> ${LINKEDIN_REDIRECT_URI}</p>
                <p><strong>Scopes:</strong> ${LINKEDIN_SCOPE}</p>
                <br>
                <p>üîó <strong>Click the link above to test real LinkedIn OAuth</strong></p>
                <p>‚ö†Ô∏è Make sure the redirect URI is added to your LinkedIn app settings!</p>
            `);
            
            // Actually redirect to LinkedIn (uncomment to test)
            // window.location.href = authUrl;
        }

        function testLinkedInSimulated() {
            // Test the simulated flow
            showTestResults('Simulated LinkedIn Flow', `
                <strong>üß™ Simulated Flow Active</strong><br>
                <p>This flow works for development and testing.</p>
                <p>‚úÖ Creates mock LinkedIn profile data</p>
                <p>‚úÖ Updates SF user profile with professional info</p>
                <p>‚úÖ Activates founder/mentor personas</p>
                <br>
                <button onclick="runSimulatedFlow()" style="background: #0077B5; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                    Run Simulated Flow
                </button>
            `);
        }

        function runSimulatedFlow() {
            // This runs the simulated LinkedIn flow from your existing code
            const resultsDiv = document.getElementById('resultsContent');
            resultsDiv.innerHTML += `<br><p>üîÑ Running simulated LinkedIn authentication...</p>`;
            
            setTimeout(() => {
                const mockProfile = {
                    id: 'ln_' + generateRandomString(10),
                    fullName: 'LinkedIn Professional Test',
                    headline: 'Senior Professional | Industry Expert',
                    email: 'test_' + generateRandomString(6) + '@linkedin.example.com',
                    profilePicture: 'https://ui-avatars.com/api/?name=LinkedIn+Test&background=0077B5&color=fff',
                    industry: 'Technology',
                    skills: ['Leadership', 'Strategy', 'Innovation', 'Business Development'],
                    credibilityScore: 95
                };
                
                resultsDiv.innerHTML += `
                    <br><strong>‚úÖ Mock Profile Created:</strong>
                    <div style="background: #f0f0f0; padding: 15px; border-radius: 6px; margin: 10px 0;">
                        <p><strong>Name:</strong> ${mockProfile.fullName}</p>
                        <p><strong>Headline:</strong> ${mockProfile.headline}</p>
                        <p><strong>Email:</strong> ${mockProfile.email}</p>
                        <p><strong>Skills:</strong> ${mockProfile.skills.join(', ')}</p>
                        <p><strong>Credibility Score:</strong> ${mockProfile.credibilityScore}/100</p>
                    </div>
                    <p>This profile would be saved to the user's SF account and enable professional features.</p>
                `;
            }, 1000);
        }

        function showTestResults(title, content) {
            const testResults = document.getElementById('testResults');
            const resultsContent = document.getElementById('resultsContent');
            
            resultsContent.innerHTML = `<h3>${title}</h3>${content}`;
            testResults.style.display = 'block';
            testResults.scrollIntoView({ behavior: 'smooth' });
        }

        // Show debug information
        function loadDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
Current URL: ${window.location.origin}
LinkedIn Client ID: ${LINKEDIN_CLIENT_ID}
Redirect URI: ${LINKEDIN_REDIRECT_URI}
Scopes: ${LINKEDIN_SCOPE}
Environment: ${window.location.hostname === 'localhost' ? 'Development' : 'Production'}
Callback File: ${window.location.origin}/linkedin-callback.html

LinkedIn App Settings Required:
‚úÖ Client ID: 77tpngrlwmwnz7 (configured)
‚ö†Ô∏è Redirect URIs: Must include ${LINKEDIN_REDIRECT_URI}
‚ö†Ô∏è Scopes: openid, profile, email (must be approved)
            `;
        }

        // Load debug info on page load
        window.addEventListener('load', loadDebugInfo);
    </script>
</body>
</html>

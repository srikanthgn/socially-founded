<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Authentication - SociallyFounded</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            min-height: 100vh;
            color: #003554;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .callback-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 53, 84, 0.1);
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .sf-logo {
            height: 40px;
            margin-bottom: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e0e0e0;
            border-top: 3px solid #D4AF37;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-message {
            font-size: 16px;
            margin-bottom: 20px;
            color: #003554;
        }

        .success-message {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid #2ecc71;
            border-radius: 8px;
            color: #2ecc71;
            padding: 16px;
            margin-top: 20px;
            font-size: 14px;
        }

        .error-message {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            border-radius: 8px;
            color: #e74c3c;
            padding: 16px;
            margin-top: 20px;
            font-size: 14px;
        }

        .linkedin-info {
            background: rgba(0, 119, 181, 0.1);
            border: 1px solid #0077B5;
            border-radius: 8px;
            color: #0077B5;
            padding: 16px;
            margin-top: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="callback-container">
        <img src="https://sociallyfounded.com/assets/sf-logo.png" alt="SociallyFounded" class="sf-logo">
        
        <div class="loading-spinner"></div>
        <div class="status-message">Processing LinkedIn authentication...</div>
        <div id="messageContainer"></div>
    </div>

    <script>
        class SimpleLinkedInCallback {
            constructor() {
                console.log('🔗 Simple LinkedIn Callback: Starting...');
                this.initialize();
            }

            initialize() {
                try {
                    console.log('🔗 Checking URL parameters...');
                    const urlParams = new URLSearchParams(window.location.search);
                    const code = urlParams.get('code');
                    const state = urlParams.get('state');
                    const error = urlParams.get('error');

                    console.log('🔗 URL params:', { 
                        code: code ? 'Present' : 'Missing', 
                        state: state ? 'Present' : 'Missing', 
                        error: error || 'None' 
                    });

                    if (error) {
                        throw new Error(`LinkedIn OAuth error: ${error}`);
                    }

                    if (!code) {
                        throw new Error('No authorization code received from LinkedIn');
                    }

                    // Show LinkedIn info
                    this.showLinkedInInfo(code);

                    // Simulate processing time then redirect to welcome
                    this.processLinkedInAuth(code);

                } catch (error) {
                    console.error('❌ LinkedIn Callback Error:', error);
                    this.handleError(error.message);
                }
            }

            showLinkedInInfo(code) {
                const truncatedCode = code.substring(0, 20) + '...';
                this.showMessage(`LinkedIn authorization successful! Code: ${truncatedCode}`, 'linkedin');
            }

            async processLinkedInAuth(code) {
                // Update status messages to show progress
                await this.delay(1000);
                this.updateStatus('Validating LinkedIn authorization...');
                
                await this.delay(1000);
                this.updateStatus('Creating your professional profile...');
                
                await this.delay(1000);
                this.updateStatus('Setting up your SF Passport...');
                
                await this.delay(1000);
                this.updateStatus('Preparing your dashboard...');
                
                // Store LinkedIn data in localStorage for now
                const linkedinData = {
                    authCode: code,
                    verifiedAt: new Date().toISOString(),
                    passportId: this.generateSFPassportId(),
                    tier: 'Silver',
                    level: 2,
                    points: 750,
                    achievements: ['Digital Passport', 'LinkedIn Professional', 'Early Adopter', 'Silver Member']
                };

                localStorage.setItem('sf_linkedin_auth', JSON.stringify(linkedinData));
                console.log('✅ LinkedIn data stored in localStorage:', linkedinData);

                this.handleSuccess();
            }

            generateSFPassportId() {
                const randomDigits = Math.floor(1000000 + Math.random() * 9000000);
                const countryCode = this.getCountryCode();
                return `SF-${randomDigits}-${countryCode}`;
            }

            getCountryCode() {
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                if (timezone.includes('Dubai') || timezone.includes('UAE')) return 'AE';
                if (timezone.includes('New_York') || timezone.includes('Los_Angeles')) return 'US';
                if (timezone.includes('London')) return 'GB';
                if (timezone.includes('Berlin')) return 'DE';
                if (timezone.includes('Tokyo')) return 'JP';
                if (timezone.includes('Sydney')) return 'AU';
                if (timezone.includes('Mumbai') || timezone.includes('Kolkata')) return 'IN';
                return 'US'; // Default
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            updateStatus(message) {
                document.querySelector('.status-message').textContent = message;
            }

            handleSuccess() {
                document.querySelector('.loading-spinner').style.display = 'none';
                this.updateStatus('');
                this.showMessage('🎉 LinkedIn verification successful! Welcome to SociallyFounded Premium. Redirecting to your dashboard...', 'success');
                
                console.log('✅ LinkedIn authentication complete, redirecting to welcome page...');
                
                setTimeout(() => {
                    window.location.href = 'https://sociallyfounded.com/welcome/';
                }, 3000);
            }

            handleError(message) {
                document.querySelector('.loading-spinner').style.display = 'none';
                this.updateStatus('Authentication failed');
                this.showMessage(`Error: ${message}`, 'error');
                
                setTimeout(() => {
                    window.location.href = 'https://sociallyfounded.com/';
                }, 5000);
            }

            showMessage(text, type) {
                const container = document.getElementById('messageContainer');
                
                switch(type) {
                    case 'error':
                        container.className = 'error-message';
                        break;
                    case 'success':
                        container.className = 'success-message';
                        break;
                    case 'linkedin':
                        container.className = 'linkedin-info';
                        break;
                    default:
                        container.className = '';
                }
                
                container.textContent = text;
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('📄 DOM: Content loaded, starting simple LinkedIn callback...');
            new SimpleLinkedInCallback();
        });
    </script>
</body>
</html>
